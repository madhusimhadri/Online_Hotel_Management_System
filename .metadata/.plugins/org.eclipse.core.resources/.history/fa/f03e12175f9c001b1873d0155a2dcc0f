package com.room.service;

import java.util.HashMap;
import java.util.NoSuchElementException;

import org.slf4j.Logger;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Service;

import com.room.model.Show;
import com.room.model.RoomDetails;
import com.room.model.RoomType;
import com.room.repository.RoomTypeRepository;


@Service
public class RoomTypeService {
	
	@Autowired
	RoomTypeRepository roomTypeDao;
	
	@Autowired
	RoomType roomTypeInventory;
	
	@Autowired
	Logger LOGGER;
	
	@Value("${room.type.id}")
	private String roomTypeId;
	
	// for adding and updating as we are using hashMap, latest value will be considered
	public Show addNewType(RoomDetails roomDetails) {
		String type = roomDetails.getType();
		long price = roomDetails.getPrice();
		
		try {
			RoomType roomTypeInv = roomTypeDao.findById(roomTypeId).get();
			HashMap<String,Long> roomTypes = roomTypeInv.getRoomType();
			roomTypes.put(type, price);
			roomTypeInv.setRoomType(roomTypes);
			roomTypeDao.save(roomTypeInv);
			
		}catch(NoSuchElementException e) {
			//This exception will occur if collection is empty
			LOGGER.warn(e.getMessage());
			HashMap<String, Long> roomTypes = new HashMap<String, Long>();
			roomTypes.put(type, price);
			roomTypeInventory.setId(roomTypeId);
			roomTypeInventory.setRoomType(roomTypes);
			roomTypeDao.save(roomTypeInventory);
			
		}
		return new Show(type+" "+price,"Success");
		//return "Added new Room of type "+type+" with Price "+price;		
	}
	
	//Get all types
	public RoomType getAllTypes() {
		try {
			return roomTypeDao.findById(roomTypeId).get();
		}catch(Exception e){
			
			HashMap<String, Long> dummy = new HashMap<String, Long>();
			LOGGER.warn(e.getMessage());
			return new RoomType("NoTypesFound",dummy);
		}
	}
	//For deleting roomType
	public Show deleteByKey(String roomType) {
		try {
			RoomType roomTypeInv = roomTypeDao.findById(roomTypeId).get();
			HashMap<String, Long> allTypes = roomTypeInv.getRoomType();
			if(!allTypes.containsKey(roomType)) {
				throw new NoSuchElementException();
			}
			allTypes.remove(roomType);
			roomTypeInv.setRoomType(allTypes);
			roomTypeDao.save(roomTypeInv);
			return new Show(roomType,"Delete Success");
		}catch(NoSuchElementException e) {
			LOGGER.warn(e.getMessage());
			return new Show("bad Request","No such element exists");
		}
	}
}
